title       "'<%= @request_type %>' Requests Per Second"
area        :none
hide_legend true
vtitle      'reqs / sec'
description "API Requests as seen by stats.timers.<%= @app_name %>.application.byRequestType.<%= @request_type %>.*.count, scaled by <%= @scaling_factor %>"

# Our metrics have a structure like this:
#
#    stats.timers.<%= @app_name %>.application.byRequestType.$REQUEST_TYPE.$HTTP_VERB.count
#
# Since these particular counts are cumulative in <%= (1.0 / @scaling_factor) %>
# second windows (our current smallest granularity in Graphite), we
# need to scale down by <%= @scaling_factor %> in order to obtain per
# second rates.  Count metrics in the 'stats.*' hierarchy (not
# 'stats.timers.*') are automatically rescaled by estatsd into per
# second rates.
#
# We need to group by the request type ("node 5", counting from 0) and
# sum up all the individual HTTP verb counts.
#
field :group,
      :data => 'scale(sumSeries(stats.timers.<%= @app_name %>.application.byRequestType.<%= @request_type %>.*.count), <%= @scaling_factor %>)',
      :alias_by_node => 5
